@section Scripts {
	<script src="~/lib/knockout-lazy/knockout-lazy.js" type="text/javascript"></script>
}

<script type="text/javascript">
	
	//Mapper to use when mapping received categories to js objects
	var TreeViewNodeMapper = {
		"subcategories" : {
			create: function(options) {
				var result = ko.mapping.fromJS(options.data);

				function loader(target)
				{
					if (target.loading != false)
						return;
					target.loading = true;
					//Load actual data
					target.subcategories([]);
					target.documents([]);
					target.books([]);
					//Free up memory
					delete target.loading;
				}

				result.loading = false;
				result.subcategories = (loader, result);
				result.documents = ko.onDemandObservable(loader, result);
				result.books = ko.onDemandObservable(loader, result);

				return result;
			}
		}
	}

	//Organizer ID of the organizer we are viewing
	RootVM.OrganizerID = @ViewData["OrganizerID"];
	//VM for tree view
	RootVM.TreeViewVM = {
		subcategories : ko.observableArray(),
		documents: ko.observableArray(),
		books: ko.observableArray()
	};

	//Load data after page load
	OnLoadCallback.push(() => {
		fetch("/Organizers/" + RootVM.OrganizerID + "/root")
		.then(response => response.json())
		.then(json => ko.mapping.fromJS(json, TreeViewNodeMapper, RootVM.TreeViewVM));
	});
</script>